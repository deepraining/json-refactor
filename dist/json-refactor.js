var r,t=(r=require("clone"))&&"object"==typeof r&&"default"in r?r.default:r,e=function(r){for(var t=[],e=arguments.length-1;e-- >0;)t[e]=arguments[e+1];console.error.apply(console,["json-refactor: "+r].concat(t))},n={},o=n.toString;function a(r){return null===r?""+r:"object"==typeof r||"function"==typeof r?n[o.call(r)]||"object":typeof r}function i(r,t){return r&&"object"==typeof r?t&&"object"==typeof t?a(r)===a(t)||(e("target and mapping rules are not the same type, they should both be map or array"),e("target: ",r),e("mapping rules: ",t),!1):(e("mapping rules is invalid, it should be a map or an array"),e("mapping rules: ",t),!1):(e("target is invalid, it should be a map or an array"),e("target: ",r),!1)}"Boolean Number String Function Array Date RegExp Object Error Symbol".split(" ").forEach(function(r){n["[object "+r+"]"]=r.toLowerCase()});var f={keepOnHandling:"_",operatorDelimiter:"|"},l=[];function s(r,e,n){var o=e[n].split(f.operatorDelimiter),i=o.shift(),s=o;r[n]=i.indexOf(".")>-1?function(r,e){for(var n,o,a=e.split("."),i=r,f=0;f<a.length;f+=1){if(void 0===i[o=a[f]]){n=void 0;break}n=i=i[o]}if(void 0!==n)return n&&"object"==typeof n?t(n):n}(r,i):r[i],s.forEach(function(t){l.forEach(function(e){"string"==typeof e.test?t===e.test&&(r[n]=e.handler(r[n],t)):"regexp"===a(e.test)&&e.test.test(t)&&(r[n]=e.handler(r[n],t))})})}var u=function(r,t){i(r,t)&&(Array.isArray(t)?r.forEach(function(r){u(r,t[0])}):Object.keys(t).forEach(function(n){var o=t[n],a=r[n];if(n.slice(0,f.keepOnHandling.length)===f.keepOnHandling&&(a=r[n.slice(f.keepOnHandling.length)]),"object"==typeof o){if(!i(a,o))return;Array.isArray(o)?a.forEach(function(r){i(r,o[0])&&u(r,o[0])}):u(a,o)}else"string"==typeof o?s(r,t,n):e("can't resolve key: "+JSON.stringify(o))}))};function c(r,e,n){if(!i(r,e))return r;var o=n?t(r):r;return u(o,e),o}function p(r,t){r&&(r&&t?l.push({test:r,handler:t}):"object"==typeof r&&(Array.isArray(r)?l.push.apply(l,r):l.push(r)))}var y={test:"float",handler:function(r){return parseFloat(r)}},h={test:/^sum!/,handler:function(r,t){var n=t.split("!")[1],o=0;return n?r&&Array.isArray(r)?(r.forEach(function(r){o+=r[n]}),o):(e("original value should be an array for operator '"+t+"'.",r),o):(e("'"+t+"' is not a valid operator."),o)}},d={test:/^average!/,handler:function(r,t){var n=t.split("!")[1],o=0,a=0;return n?r&&Array.isArray(r)?(r.forEach(function(r){o+=r[n],a+=1}),o/a):(e("original value should be an array for operator '"+t+"'.",r),o):(e("'"+t+"' is not a valid operator."),o)}};p({test:"int",handler:function(r){return parseInt(r,10)}}),p(y),p({test:"bool",handler:function(r){return!!r}}),p({test:"string",handler:function(r){return""+r}}),p(h),p(d),c.set=function(r){r&&"object"==typeof r&&Object.keys(r).forEach(function(t){f[t]=r[t]})},c.register=p,module.exports=c;
//# sourceMappingURL=json-refactor.js.map
