import r from"clone";var t=function(r){for(var t=[],e=arguments.length-1;e-- >0;)t[e]=arguments[e+1];console.error.apply(console,["json-refactor: "+r].concat(t))},e={},n=e.toString;function o(r){return null===r?""+r:"object"==typeof r||"function"==typeof r?e[n.call(r)]||"object":typeof r}function a(r,e){return r&&"object"==typeof r?e&&"object"==typeof e?o(r)===o(e)||(t("target and mapping rules are not the same type, they both should be map or array"),t("target: ",r),t("mapping rules: ",e),!1):(t("mapping rules is invalid, it should be a map or an array"),t("mapping rules: ",e),!1):(t("target is invalid, it should be a map or an array"),t("target: ",r),!1)}"Boolean Number String Function Array Date RegExp Object Error Symbol".split(" ").forEach(function(r){e["[object "+r+"]"]=r.toLowerCase()});var i={keepOnHandling:"_",operatorDelimiter:"|"},f=[];function l(t,e,n){var a=e[n].split(i.operatorDelimiter),l=a.shift(),s=a;t[n]=l.indexOf(".")>-1?function(t,e){for(var n,o,a=e.split("."),i=t,f=0;f<a.length;f+=1){if(void 0===i[o=a[f]]){n=void 0;break}n=i=i[o]}if(void 0!==n)return n&&"object"==typeof n?r(n):n}(t,l):t[l],s.forEach(function(r){f.forEach(function(e){"string"==typeof e.test?r===e.test&&(t[n]=e.handler(t[n],r)):"regexp"===o(e.test)&&e.test.test(r)&&(t[n]=e.handler(t[n],r))})})}var s=function(r,e){a(r,e)&&(Array.isArray(e)?r.forEach(function(r){s(r,e[0])}):Object.keys(e).forEach(function(n){var o=e[n],f=r[n];if(n.slice(0,i.keepOnHandling.length)===i.keepOnHandling&&(f=r[n.slice(i.keepOnHandling.length)]),"object"==typeof o){if(!a(f,o))return;Array.isArray(o)?f.forEach(function(r){a(r,o[0])&&s(r,o[0])}):s(f,o)}else"string"==typeof o?l(r,e,n):t("can't resolve key: "+JSON.stringify(o))}))};function c(t,e,n){if(!a(t,e))return t;var o=n?r(t):t;return s(o,e),o}function u(r,t){r&&(r&&t?f.push({test:r,handler:t}):"object"==typeof r&&(Array.isArray(r)?f.push.apply(f,r):f.push(r)))}var p={test:"float",handler:function(r){return parseFloat(r)}},y={test:/^sum!/,handler:function(r,e){var n=e.split("!")[1],o=0;return n?r&&Array.isArray(r)?(r.forEach(function(r){o+=r[n]}),o):(t("original value should be an array for operator '"+e+"'.",r),o):(t("'"+e+"' is not a valid operator."),o)}},h={test:/^average!/,handler:function(r,e){var n=e.split("!")[1],o=0,a=0;return n?r&&Array.isArray(r)?(r.forEach(function(r){o+=r[n],a+=1}),o/a):(t("original value should be an array for operator '"+e+"'.",r),o):(t("'"+e+"' is not a valid operator."),o)}};u({test:"int",handler:function(r){return parseInt(r,10)}}),u(p),u({test:"bool",handler:function(r){return!!r}}),u({test:"string",handler:function(r){return""+r}}),u(y),u(h),c.set=function(r){r&&"object"==typeof r&&Object.keys(r).forEach(function(t){i[t]=r[t]})},c.register=u;export default c;
//# sourceMappingURL=json-refactor.es.js.map
