!function(a){function b(a){return a}function c(){var a=arguments[0];if("undefined"==typeof a||null===a)return{};if("object"!=typeof a)return a;var b,e=arguments[1],f=!0;e instanceof Array||(e=a,f=!1);var g,h={};for(g in e)b=f?e[g]:g,a.hasOwnProperty(b)&&(a[b]instanceof Array?h[b]=d(a[b]):"object"==typeof a[b]?h[b]=c(a[b]):h[b]=a[b]);return h}function d(a){if("undefined"==typeof a||null===a)return[];if(!(a instanceof Array))return[];var b=[];return a.map(function(d,e){"object"!=typeof a[i]?b[e]=d:b[e]=c(d)}),b}function e(b,c){switch(c){case"int":return parseInt(b);case"float":return parseFloat(b);case"bool":return!!b;case"string":return b+"";default:return a[c]&&"function"==typeof a[c]?b=a[c](b):console.error(""+c+"：没有此内置操作，也无此全局函数"),b}}function f(a,b,f,g){var h,i=f.split("."),k=i.length,l=i[k-1],m=!!~l.indexOf("[]");if(2==k)h=m?void 0!=a[i[0]]&&a[i[0]]:void 0!=a[i[0]]&&a[i[0]][i[1]];else if(3==k)h=m?void 0!=a[i[0]]&&void 0!=a[i[0]][i[1]]&&a[i[0]][i[1]]:void 0!=a[i[0]]&&void 0!=a[i[0]][i[1]]&&a[i[0]][i[1]][i[2]];else{if(4!=k)return void console.error("点语法的解析最大只支持四级");h=m?void 0!=a[i[0]]&&void 0!=a[i[0]][i[1]]&&void 0!=a[i[0]][i[1]][i[2]]&&a[i[0]][i[1]][i[2]]:void 0!=a[i[0]]&&void 0!=a[i[0]][i[1]]&&void 0!=a[i[0]][i[1]][i[2]]&&a[i[0]][i[1]][i[2]][i[3]]}m?a[b]=j(h,l):"object"!=typeof h?a[b]=g?e(h,g):h:Array.isArray(h)?a[b]=d(h):a[b]=c(h)}function g(a,b,c,d,f){var g=a[c];a[b]=d?e(g,d):g,b!=c&&!f&&delete a[c]}function h(a,b,c){a[b]=j(a,c)}function j(a,c){var d,e=c.split("|"),f=e[0].slice(0,-2),g=e[1],h=e[2],i=e[3],j=e[4],k=!!j,l=a[f],m=0,n=0,o=0,p=0,q=[];if(!l||!Array.isArray(l))return void console.error("配置的键 "+f+" 不存在，或者值不是数组");if(k)switch(j){case"round":d=Math.round;break;case"floor":d=Math.floor;break;case"ceil":d=Math.ceil;break;case"abs":d=Math.abs;break;default:d=b,"concat"!=h&&console.error("子操作 "+j+" 不存在")}switch(h){case"sum":return l.map(function(a){m+=k?d(a[g]):a[g]}),m;case"average":return l.map(function(a){m+=k?d(a[g]):a[g]}),n=m/l.length;case"max":return l.map(function(a,b){var c=k?d(a[g]):a[g];b?c>o&&(o=c):o=c}),o;case"min":return l.map(function(a,b){var c=k?d(a[g]):a[g];b?p>c&&(p=c):p=c}),p;case"concat":return l.map(function(a){var b=k?a[g][j]():a[g];q.push(b)}),q.join(i?i:"");default:return void console.error("操作 "+h+" 不存在")}}function k(a,b,c){var d=b[c],e=!!~d.indexOf("^"),i=e?d.slice(0,-1):d,j=i.split("!"),k=j[0],l=j[1],m=!!~k.indexOf("."),n=!m&&!!~k.indexOf("[]");m?k.split(".").length>1?f(a,c,k,l):console.error("配置键名 "+i+" 有误"):n?h(a,c,k):g(a,c,k,l,e)}function l(a,b){b&&"object"==typeof b&&(Array.isArray(b)?a.map(function(a){!!b[0]&&"object"==typeof b[0]&&"object"==typeof a&&l(a,b[0])}):Object.keys(b).map(function(c){var d,e;d=b[c],e=c.startsWith("_")&&"undefined"==typeof a[c]?a[c.slice(1)]:a[c],"object"==typeof d&&e?Array.isArray(d)?e.map(function(a){d[0]&&"object"==typeof d[0]&&"object"==typeof a&&l(a,d[0])}):l(e,d):"string"==typeof d?k(a,b,c):console.error("无法解析key: \n"+("string"==typeof d?d:"object"==typeof d?JSON.stringify(d):""))}))}var m=function(a,b,e){var f=e?a instanceof Array?d(a):c(a):a;return b&&"object"==typeof b?l(f,b):console.error("传入的map格式有误，请传入对象或数组"),f};"function"==typeof define&&define.amd?define(function(){return m}):"undefined"!=typeof module&&module.exports?module.exports=m:a.JSON.refactor=m}(window);