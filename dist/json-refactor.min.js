!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=b(a,!0):b(a)}("undefined"!=typeof window?window:this,function(a,b){function c(){var a=arguments[0];if("undefined"==typeof a||null===a)return{};if("object"!=typeof a)return a;var b,e=arguments[1],f=!0;e instanceof Array||(e=a,f=!1);var g,h={};for(g in e)b=f?e[g]:g,a.hasOwnProperty(b)&&(a[b]instanceof Array?h[b]=d(a[b]):"object"==typeof a[b]?h[b]=c(a[b]):h[b]=a[b]);return h}function d(a){if("undefined"==typeof a||null===a)return[];if(!(a instanceof Array))return[];var b,d=[];for(b in a)"object"==typeof a[b]?d[b]=c(a[b]):d[b]=a[b];return d}function e(b,c){switch(c){case"int":return parseInt(b);case"float":return parseFloat(b);case"bool":return!!b;case"string":return b+"";default:return!!a[c]&&"function"==typeof a[c]&&(b=a[c](b)),b}}function f(a,b,f,g){var h,j=f.split("."),k=j.length,l=j[k-1],m=!!~l.indexOf("[]");if(2==k)h=m?void 0!=a[j[0]]&&a[j[0]]:void 0!=a[j[0]]&&a[j[0]][j[1]];else if(3==k)h=m?void 0!=a[j[0]]&&void 0!=a[j[0]][j[1]]&&a[j[0]][j[1]]:void 0!=a[j[0]]&&void 0!=a[j[0]][j[1]]&&a[j[0]][j[1]][j[2]];else{if(4!=k)return void console.error("点语法的解析最大只支持四级");h=m?void 0!=a[j[0]]&&void 0!=a[j[0]][j[1]]&&void 0!=a[j[0]][j[1]][j[2]]&&a[j[0]][j[1]][j[2]]:void 0!=a[j[0]]&&void 0!=a[j[0]][j[1]]&&void 0!=a[j[0]][j[1]][j[2]]&&a[j[0]][j[1]][j[2]][j[3]]}m?a[b]=i(h,l):"object"!=typeof h?a[b]=g?e(h,g):h:Array.isArray(h)?a[b]=d(h):a[b]=c(h)}function g(a,b,c,d,f){var g=a[c];a[b]=d?e(g,d):g,b!=c&&!f&&delete a[c]}function h(a,b,c){a[b]=i(a,c)}function i(a,b){var c,d=b.split("|"),e=d[0].slice(0,-2),f=d[1],g=d[2],h=d[3],i=d[4],j=!!i,k=a[e],l=0,m=0,n=0,o=0,p=[];if(!k||!Array.isArray(k))return void console.error("配置的键 "+e+" 不存在，或者值不是数组");if(j)switch(i){case"round":c=Math.round;break;case"floor":c=Math.floor;break;case"ceil":c=Math.ceil;break;case"abs":c=Math.abs}switch(g){case"sum":return k.map(function(a){l+=j?c(a[f]):a[f]}),l;case"average":return k.map(function(a){l+=j?c(a[f]):a[f]}),m=l/k.length;case"max":return k.map(function(a,b){var d=j?c(a[f]):a[f];b?d>n&&(n=d):n=d}),n;case"min":return k.map(function(a,b){var d=j?c(a[f]):a[f];b?o>d&&(o=d):o=d}),o;case"concat":return k.map(function(a){var b=j?a[f][i]():a[f];p.push(b)}),p.join(h?h:"");default:return}}function j(a,b,c){var d=b[c],e=!!~d.indexOf("^"),i=e?d.slice(0,-1):d,j=i.split("!"),k=j[0],l=j[1],m=!!~k.indexOf("."),n=!m&&!!~k.indexOf("[]");m?k.split(".").length>1?f(a,c,k,l):console.error("配置键名 "+i+" 有误"):n?h(a,c,k):g(a,c,k,l,e)}function k(a,b){Array.isArray(b)?a.map(function(a){b[0]&&"object"==typeof a&&k(a,b[0])}):Object.keys(b).map(function(c){var d,e;d=b[c],e=c.startsWith("_")&&void 0==a[c]?a[c.slice(1)]:a[c],"object"==typeof d&&e?Array.isArray(d)?e.map(function(a){d[0]&&"object"==typeof a&&k(a,d[0])}):k(e,d):j(a,b,c)})}var l=function(a,b,e){var f=e?a instanceof Array?d(a):c(a):a;return k(f,b),f};return b||(a.JSON.refactor=l),l});