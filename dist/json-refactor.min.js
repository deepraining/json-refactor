!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=b(a,!0):b(a)}("undefined"!=typeof window?window:this,function(a,b){function c(a){return a}function d(){var a=arguments[0];if("undefined"==typeof a||null===a)return{};if("object"!=typeof a)return a;var b,c=arguments[1],f=!0;c instanceof Array||(c=a,f=!1);var g,h={};for(g in c)b=f?c[g]:g,a.hasOwnProperty(b)&&(a[b]instanceof Array?h[b]=e(a[b]):"object"==typeof a[b]?h[b]=d(a[b]):h[b]=a[b]);return h}function e(a){if("undefined"==typeof a||null===a)return[];if(!(a instanceof Array))return[];var b=[];return a.map(function(c,e){"object"!=typeof a[i]?b[e]=c:b[e]=d(c)}),b}function f(b,c){switch(c){case"int":return parseInt(b);case"float":return parseFloat(b);case"bool":return!!b;case"string":return b+"";default:return a[c]&&"function"==typeof a[c]?b=a[c](b):console.error(""+c+"：没有此内置操作，也无此全局函数"),b}}function g(a,b,c,g){var h,i=c.split("."),j=i.length,l=i[j-1],m=!!~l.indexOf("[]");if(2==j)h=m?void 0!=a[i[0]]&&a[i[0]]:void 0!=a[i[0]]&&a[i[0]][i[1]];else if(3==j)h=m?void 0!=a[i[0]]&&void 0!=a[i[0]][i[1]]&&a[i[0]][i[1]]:void 0!=a[i[0]]&&void 0!=a[i[0]][i[1]]&&a[i[0]][i[1]][i[2]];else{if(4!=j)return void console.error("点语法的解析最大只支持四级");h=m?void 0!=a[i[0]]&&void 0!=a[i[0]][i[1]]&&void 0!=a[i[0]][i[1]][i[2]]&&a[i[0]][i[1]][i[2]]:void 0!=a[i[0]]&&void 0!=a[i[0]][i[1]]&&void 0!=a[i[0]][i[1]][i[2]]&&a[i[0]][i[1]][i[2]][i[3]]}m?a[b]=k(h,l):"object"!=typeof h?a[b]=g?f(h,g):h:Array.isArray(h)?a[b]=e(h):a[b]=d(h)}function h(a,b,c,d,e){var g=a[c];a[b]=d?f(g,d):g,b!=c&&!e&&delete a[c]}function j(a,b,c){a[b]=k(a,c)}function k(a,b){var d,e=b.split("|"),f=e[0].slice(0,-2),g=e[1],h=e[2],i=e[3],j=e[4],k=!!j,l=a[f],m=0,n=0,o=0,p=0,q=[];if(!l||!Array.isArray(l))return void console.error("配置的键 "+f+" 不存在，或者值不是数组");if(k)switch(j){case"round":d=Math.round;break;case"floor":d=Math.floor;break;case"ceil":d=Math.ceil;break;case"abs":d=Math.abs;break;default:d=c,"concat"!=h&&console.error("子操作 "+j+" 不存在")}switch(h){case"sum":return l.map(function(a){m+=k?d(a[g]):a[g]}),m;case"average":return l.map(function(a){m+=k?d(a[g]):a[g]}),n=m/l.length;case"max":return l.map(function(a,b){var c=k?d(a[g]):a[g];b?c>o&&(o=c):o=c}),o;case"min":return l.map(function(a,b){var c=k?d(a[g]):a[g];b?p>c&&(p=c):p=c}),p;case"concat":return l.map(function(a){var b=k?a[g][j]():a[g];q.push(b)}),q.join(i?i:"");default:return void console.error("操作 "+h+" 不存在")}}function l(a,b,c){var d=b[c],e=!!~d.indexOf("^"),f=e?d.slice(0,-1):d,i=f.split("!"),k=i[0],l=i[1],m=!!~k.indexOf("."),n=!m&&!!~k.indexOf("[]");m?k.split(".").length>1?g(a,c,k,l):console.error("配置键名 "+f+" 有误"):n?j(a,c,k):h(a,c,k,l,e)}function m(a,b){Array.isArray(b)?a.map(function(a){b[0]&&"object"==typeof a&&m(a,b[0])}):Object.keys(b).map(function(c){var d,e;d=b[c],e=c.startsWith("_")&&void 0==a[c]?a[c.slice(1)]:a[c],"object"==typeof d&&e?Array.isArray(d)?e.map(function(a){d[0]&&"object"==typeof a&&m(a,d[0])}):m(e,d):l(a,b,c)})}var n=function(a,b,c){var f=c?a instanceof Array?e(a):d(a):a;return m(f,b),f};return b||(a.JSON.refactor=n),n});