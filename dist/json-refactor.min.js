!function(r){function e(r){return r}function n(){var r=arguments[0];if("undefined"==typeof r||null===r)return{};if("object"!=typeof r)return r;var e,o=arguments[1],a=!0;o instanceof Array||(o=r,a=!1);var i,f={};for(i in o)e=a?o[i]:i,r.hasOwnProperty(e)&&(r[e]instanceof Array?f[e]=t(r[e]):"object"==typeof r[e]?f[e]=n(r[e]):f[e]=r[e]);return f}function t(r){if("undefined"==typeof r||null===r)return[];if(!(r instanceof Array))return[];var e=[];return r.map(function(r,t){"object"!=typeof r?e[t]=r:e[t]=n(r)}),e}function o(e,n){switch(n){case"int":return parseInt(e);case"float":return parseFloat(e);case"bool":return!!e;case"string":return e+"";default:return r[n]&&"function"==typeof r[n]?e=r[n](e):console.error(""+n+"：没有此内置操作，也无此全局函数"),e}}function a(r,e,a,i){var f,s=a.split("."),u=s.length,y=s[u-1],l=!!~y.indexOf("[]"),p=r,d=0;if(l)for(d=0;d<u-1;d++){if("undefined"==typeof p[s[d]]){f=void 0;break}p=p[s[d]],f=p}else for(d=0;d<u;d++){if("undefined"==typeof p[s[d]]){f=void 0;break}p=p[s[d]],f=p}"undefined"!=typeof f&&(l?r[e]=c(f,y):f&&"object"==typeof f?Array.isArray(f)?r[e]=t(f):r[e]=n(f):r[e]=i?o(f,i):f)}function i(r,e,n,t,a){var i=r[n];r[e]=t?o(i,t):i,e!=n&&!a&&delete r[n]}function f(r,e,n){r[e]=c(r,n)}function c(r,n){var t,o=n.split("|"),a=o[0].slice(0,-2),i=o[1],f=o[2],c=o[3],s=o[4],u=!!s,y=r[a],l=0,p=0,d=0,A=0,b=[];if(!y||!Array.isArray(y))return void console.error("配置的键 "+a+" 不存在，或者值不是数组");if(u)switch(s){case"round":t=Math.round;break;case"floor":t=Math.floor;break;case"ceil":t=Math.ceil;break;case"abs":t=Math.abs;break;default:t=e,"concat"!=f&&console.error("子操作 "+s+" 不存在")}switch(f){case"sum":return y.map(function(r){l+=u?t(r[i]):r[i]}),l;case"average":return y.map(function(r){l+=u?t(r[i]):r[i]}),p=l/y.length;case"max":return y.map(function(r,e){var n=u?t(r[i]):r[i];e?n>d&&(d=n):d=n}),d;case"min":return y.map(function(r,e){var n=u?t(r[i]):r[i];e?n<A&&(A=n):A=n}),A;case"concat":return y.map(function(r){var e=u?r[i][s]():r[i];b.push(e)}),b.join(c?c:"");default:return void console.error("操作 "+f+" 不存在")}}function s(r,e,n){var t=e[n],o=!!~t.indexOf("^"),c=o?t.slice(0,-1):t,s=c.split("!"),u=s[0],y=s[1],l=!!~u.indexOf("."),p=!l&&!!~u.indexOf("[]");l?u.split(".").length>1?a(r,n,u,y):console.error("配置键名 "+c+" 有误"):p?f(r,n,u):i(r,n,u,y,o)}function u(r,e){return r&&e&&"object"==typeof r&&"object"==typeof e?!(Array.isArray(e)&&!Array.isArray(r)||!Array.isArray(e)&&Array.isArray(r))||(console.error("target类型与map类型不匹配"),console.error("target: "+JSON.stringify(r)),console.error("map: "+JSON.stringify(e)),!1):(console.error("target与map必须是对象或数组"),console.error("target: "+JSON.stringify(r)),console.error("map: "+JSON.stringify(e)),!1)}function y(r,e){u(r,e)&&(Array.isArray(e)?r.map(function(r){y(r,e[0])}):Object.keys(e).map(function(n){var t,o;if(t=e[n],o="_"==n.slice(0,1)&&"undefined"==typeof r[n]?r[n.slice(1)]:r[n],"object"==typeof t){if(!u(o,t))return;Array.isArray(t)?o.map(function(r){u(r,t[0])&&y(r,t[0])}):y(o,t)}else"string"==typeof t?s(r,e,n):console.error("无法解析key: \n"+("string"==typeof t?t:"object"==typeof t?JSON.stringify(t):""))}))}var l=function(r,e,o){if(!r||"object"!=typeof r)return console.error("传入的source格式有误，请传入对象或数组"),a;if(!e||"object"!=typeof e)return console.error("传入的map格式有误，请传入对象或数组"),a;var a=o?Array.isArray(r)?t(r):n(r):r;return y(a,e),a};JSON.refactor=l}(this);