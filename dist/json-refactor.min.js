!function(r){function e(r){return r}function o(){var r=arguments[0];if("undefined"==typeof r||null===r)return{};if("object"!=typeof r)return r;var e,t=arguments[1],i=!0;t instanceof Array||(t=r,i=!1);var a,c={};for(a in t)e=i?t[a]:a,r.hasOwnProperty(e)&&(r[e]instanceof Array?c[e]=n(r[e]):"object"==typeof r[e]?c[e]=o(r[e]):c[e]=r[e]);return c}function n(r){if("undefined"==typeof r||null===r)return[];if(!(r instanceof Array))return[];var e=[];return r.map(function(r,n){"object"!=typeof r?e[n]=r:e[n]=o(r)}),e}function t(e,o){switch(o){case"int":return parseInt(e);case"float":return parseFloat(e);case"bool":return!!e;case"string":return e+"";default:return r[o]&&"function"==typeof r[o]?e=r[o](e):console.error(""+o+"：没有此内置操作，也无此全局函数"),e}}function i(r,e,i,a){var c,s=i.split("."),u=s.length,y=s[u-1],l=!!~y.indexOf("[]");if(2==u)c=l?void 0!=r[s[0]]&&r[s[0]]:void 0!=r[s[0]]&&r[s[0]][s[1]];else if(3==u)c=l?void 0!=r[s[0]]&&void 0!=r[s[0]][s[1]]&&r[s[0]][s[1]]:void 0!=r[s[0]]&&void 0!=r[s[0]][s[1]]&&r[s[0]][s[1]][s[2]];else{if(4!=u)return void console.error("点语法的解析最大只支持四级");c=l?void 0!=r[s[0]]&&void 0!=r[s[0]][s[1]]&&void 0!=r[s[0]][s[1]][s[2]]&&r[s[0]][s[1]][s[2]]:void 0!=r[s[0]]&&void 0!=r[s[0]][s[1]]&&void 0!=r[s[0]][s[1]][s[2]]&&r[s[0]][s[1]][s[2]][s[3]]}l?r[e]=f(c,y):"object"!=typeof c?r[e]=a?t(c,a):c:Array.isArray(c)?r[e]=n(c):r[e]=o(c)}function a(r,e,o,n,i){var a=r[o];r[e]=n?t(a,n):a,e!=o&&!i&&delete r[o]}function c(r,e,o){r[e]=f(r,o)}function f(r,o){var n,t=o.split("|"),i=t[0].slice(0,-2),a=t[1],c=t[2],f=t[3],s=t[4],u=!!s,y=r[i],l=0,p=0,d=0,v=0,A=[];if(!y||!Array.isArray(y))return void console.error("配置的键 "+i+" 不存在，或者值不是数组");if(u)switch(s){case"round":n=Math.round;break;case"floor":n=Math.floor;break;case"ceil":n=Math.ceil;break;case"abs":n=Math.abs;break;default:n=e,"concat"!=c&&console.error("子操作 "+s+" 不存在")}switch(c){case"sum":return y.map(function(r){l+=u?n(r[a]):r[a]}),l;case"average":return y.map(function(r){l+=u?n(r[a]):r[a]}),p=l/y.length;case"max":return y.map(function(r,e){var o=u?n(r[a]):r[a];e?o>d&&(d=o):d=o}),d;case"min":return y.map(function(r,e){var o=u?n(r[a]):r[a];e?o<v&&(v=o):v=o}),v;case"concat":return y.map(function(r){var e=u?r[a][s]():r[a];A.push(e)}),A.join(f?f:"");default:return void console.error("操作 "+c+" 不存在")}}function s(r,e,o){var n=e[o],t=!!~n.indexOf("^"),f=t?n.slice(0,-1):n,s=f.split("!"),u=s[0],y=s[1],l=!!~u.indexOf("."),p=!l&&!!~u.indexOf("[]");l?u.split(".").length>1?i(r,o,u,y):console.error("配置键名 "+f+" 有误"):p?c(r,o,u):a(r,o,u,y,t)}function u(r,e){return"object"!=typeof r||"object"!=typeof e?(console.error("target与map必须是对象或数组"),console.error("target: "+JSON.stringify(r)),console.error("map: "+JSON.stringify(e)),!1):!(Array.isArray(e)&&!Array.isArray(r)||!Array.isArray(e)&&Array.isArray(r))||(console.error("target类型与map类型不匹配"),console.error("target: "+JSON.stringify(r)),console.error("map: "+JSON.stringify(e)),!1)}function y(r,e){u(r,e)&&(Array.isArray(e)?r.map(function(r){y(r,e[0])}):Object.keys(e).map(function(o){var n,t;if(n=e[o],t="_"==o.slice(0,1)&&"undefined"==typeof r[o]?r[o.slice(1)]:r[o],"object"==typeof n){if(!u(t,n))return;Array.isArray(n)?t.map(function(r){u(r,n[0])&&y(r,n[0])}):y(t,n)}else"string"==typeof n?s(r,e,o):console.error("无法解析key: \n"+("string"==typeof n?n:"object"==typeof n?JSON.stringify(n):""))}))}var l=function(r,e,t){if("object"!=typeof r)return console.error("传入的source格式有误，请传入对象或数组"),i;if("object"!=typeof e)return console.error("传入的map格式有误，请传入对象或数组"),i;var i=t?Array.isArray(r)?n(r):o(r):r;return y(i,e),i};JSON.refactor=l}(this);