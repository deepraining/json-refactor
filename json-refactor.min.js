!function(r){function e(r){return r}function o(){var r=arguments[0];if("undefined"==typeof r||null===r)return{};if("object"!=typeof r)return r;var e,n=arguments[1],i=!0;n instanceof Array||(n=r,i=!1);var a,c={};for(a in n)e=i?n[a]:a,r.hasOwnProperty(e)&&(r[e]instanceof Array?c[e]=t(r[e]):"object"==typeof r[e]?c[e]=o(r[e]):c[e]=r[e]);return c}function t(r){if("undefined"==typeof r||null===r)return[];if(!(r instanceof Array))return[];var e=[];return r.map(function(r,t){"object"!=typeof r?e[t]=r:e[t]=o(r)}),e}function n(e,o){switch(o){case"int":return parseInt(e);case"float":return parseFloat(e);case"bool":return!!e;case"string":return e+"";default:return r[o]&&"function"==typeof r[o]?e=r[o](e):console.error(""+o+"：没有此内置操作，也无此全局函数"),e}}function i(r,e,i,a){var c,s=i.split("."),u=s.length,y=s[u-1],l=!!~y.indexOf("[]");if(2==u)c=l?void 0!=r[s[0]]&&r[s[0]]:void 0!=r[s[0]]&&r[s[0]][s[1]];else if(3==u)c=l?void 0!=r[s[0]]&&void 0!=r[s[0]][s[1]]&&r[s[0]][s[1]]:void 0!=r[s[0]]&&void 0!=r[s[0]][s[1]]&&r[s[0]][s[1]][s[2]];else{if(4!=u)return void console.error("点语法的解析最大只支持四级");c=l?void 0!=r[s[0]]&&void 0!=r[s[0]][s[1]]&&void 0!=r[s[0]][s[1]][s[2]]&&r[s[0]][s[1]][s[2]]:void 0!=r[s[0]]&&void 0!=r[s[0]][s[1]]&&void 0!=r[s[0]][s[1]][s[2]]&&r[s[0]][s[1]][s[2]][s[3]]}l?r[e]=f(c,y):"object"!=typeof c?r[e]=a?n(c,a):c:Array.isArray(c)?r[e]=t(c):r[e]=o(c)}function a(r,e,o,t,i){var a=r[o];r[e]=t?n(a,t):a,e!=o&&!i&&delete r[o]}function c(r,e,o){r[e]=f(r,o)}function f(r,o){var t,n=o.split("|"),i=n[0].slice(0,-2),a=n[1],c=n[2],f=n[3],s=n[4],u=!!s,y=r[i],l=0,p=0,d=0,v=0,g=[];if(!y||!Array.isArray(y))return void console.error("配置的键 "+i+" 不存在，或者值不是数组");if(u)switch(s){case"round":t=Math.round;break;case"floor":t=Math.floor;break;case"ceil":t=Math.ceil;break;case"abs":t=Math.abs;break;default:t=e,"concat"!=c&&console.error("子操作 "+s+" 不存在")}switch(c){case"sum":return y.map(function(r){l+=u?t(r[a]):r[a]}),l;case"average":return y.map(function(r){l+=u?t(r[a]):r[a]}),p=l/y.length;case"max":return y.map(function(r,e){var o=u?t(r[a]):r[a];e?o>d&&(d=o):d=o}),d;case"min":return y.map(function(r,e){var o=u?t(r[a]):r[a];e?o<v&&(v=o):v=o}),v;case"concat":return y.map(function(r){var e=u?r[a][s]():r[a];g.push(e)}),g.join(f?f:"");default:return void console.error("操作 "+c+" 不存在")}}function s(r,e,o){var t=e[o],n=!!~t.indexOf("^"),f=n?t.slice(0,-1):t,s=f.split("!"),u=s[0],y=s[1],l=!!~u.indexOf("."),p=!l&&!!~u.indexOf("[]");l?u.split(".").length>1?i(r,o,u,y):console.error("配置键名 "+f+" 有误"):p?c(r,o,u):a(r,o,u,y,n)}function u(r,e){if("object"==typeof r&&"object"==typeof e)if(Array.isArray(e)){if(!Array.isArray(r))return console.error("target类型与map类型不匹配"),console.error("target: "+JSON.stringify(r)),void console.error("map: "+JSON.stringify(e));r.map(function(r){"object"==typeof e[0]&&"object"==typeof r&&u(r,e[0])})}else{if(Array.isArray(r))return console.error("target类型与map类型不匹配"),console.error("target: "+JSON.stringify(r)),void console.error("map: "+JSON.stringify(e));Object.keys(e).map(function(o){var t,n;if(t=e[o],n="_"==o.slice(0,1)&&"undefined"==typeof r[o]?r[o.slice(1)]:r[o])if("object"==typeof t)if(Array.isArray(t)){if(!Array.isArray(n))return console.error("target类型与map类型不匹配"),console.error("target: "+JSON.stringify(n)),void console.error("map: "+JSON.stringify(t));n.map(function(r){"object"==typeof t[0]&&"object"==typeof r&&u(r,t[0])})}else{if(Array.isArray(n))return console.error("target类型与map类型不匹配"),console.error("target: "+JSON.stringify(n)),void console.error("map: "+JSON.stringify(t));u(n,t)}else"string"==typeof t?s(r,e,o):console.error("无法解析key: \n"+("string"==typeof t?t:"object"==typeof t?JSON.stringify(t):""))})}}var y=function(r,e,n){if("object"!=typeof r)return console.error("传入的source格式有误，请传入对象或数组"),i;if("object"!=typeof e)return console.error("传入的map格式有误，请传入对象或数组"),i;var i=n?Array.isArray(r)?t(r):o(r):r;return u(i,e),i};JSON.refactor=y}(this);