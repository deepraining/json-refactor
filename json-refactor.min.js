!function(e){function r(e){return e}function n(){var e=arguments[0];if("undefined"==typeof e||null===e)return{};if("object"!=typeof e)return e;var r,t=arguments[1],i=!0;t instanceof Array||(t=e,i=!1);var a,c={};for(a in t)r=i?t[a]:a,e.hasOwnProperty(r)&&(e[r]instanceof Array?c[r]=o(e[r]):"object"==typeof e[r]?c[r]=n(e[r]):c[r]=e[r]);return c}function o(e){if("undefined"==typeof e||null===e)return[];if(!(e instanceof Array))return[];var r=[];return e.map(function(e,o){"object"!=typeof e?r[o]=e:r[o]=n(e)}),r}function t(r,n){switch(n){case"int":return parseInt(r);case"float":return parseFloat(r);case"bool":return!!r;case"string":return r+"";default:return e[n]&&"function"==typeof e[n]?r=e[n](r):console.error(""+n+"：没有此内置操作，也无此全局函数"),r}}function i(e,r,i,a){var c,s=i.split("."),u=s.length,l=s[u-1],p=!!~l.indexOf("[]");if(2==u)c=p?void 0!=e[s[0]]&&e[s[0]]:void 0!=e[s[0]]&&e[s[0]][s[1]];else if(3==u)c=p?void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&e[s[0]][s[1]]:void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&e[s[0]][s[1]][s[2]];else{if(4!=u)return void console.error("点语法的解析最大只支持四级");c=p?void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&void 0!=e[s[0]][s[1]][s[2]]&&e[s[0]][s[1]][s[2]]:void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&void 0!=e[s[0]][s[1]][s[2]]&&e[s[0]][s[1]][s[2]][s[3]]}p?e[r]=f(c,l):"object"!=typeof c?e[r]=a?t(c,a):c:Array.isArray(c)?e[r]=o(c):e[r]=n(c)}function a(e,r,n,o,i){var a=e[n];e[r]=o?t(a,o):a,r!=n&&!i&&delete e[n]}function c(e,r,n){e[r]=f(e,n)}function f(e,n){var o,t=n.split("|"),i=t[0].slice(0,-2),a=t[1],c=t[2],f=t[3],s=t[4],u=!!s,l=e[i],p=0,y=0,d=0,v=0,b=[];if(!l||!Array.isArray(l))return void console.error("配置的键 "+i+" 不存在，或者值不是数组");if(u)switch(s){case"round":o=Math.round;break;case"floor":o=Math.floor;break;case"ceil":o=Math.ceil;break;case"abs":o=Math.abs;break;default:o=r,"concat"!=c&&console.error("子操作 "+s+" 不存在")}switch(c){case"sum":return l.map(function(e){p+=u?o(e[a]):e[a]}),p;case"average":return l.map(function(e){p+=u?o(e[a]):e[a]}),y=p/l.length;case"max":return l.map(function(e,r){var n=u?o(e[a]):e[a];r?n>d&&(d=n):d=n}),d;case"min":return l.map(function(e,r){var n=u?o(e[a]):e[a];r?n<v&&(v=n):v=n}),v;case"concat":return l.map(function(e){var r=u?e[a][s]():e[a];b.push(r)}),b.join(f?f:"");default:return void console.error("操作 "+c+" 不存在")}}function s(e,r,n){var o=r[n],t=!!~o.indexOf("^"),f=t?o.slice(0,-1):o,s=f.split("!"),u=s[0],l=s[1],p=!!~u.indexOf("."),y=!p&&!!~u.indexOf("[]");p?u.split(".").length>1?i(e,n,u,l):console.error("配置键名 "+f+" 有误"):y?c(e,n,u):a(e,n,u,l,t)}function u(e,r){r&&"object"==typeof r&&(Array.isArray(r)?e.map(function(e){!!r[0]&&"object"==typeof r[0]&&"object"==typeof e&&u(e,r[0])}):Object.keys(r).map(function(n){var o,t;if(o=r[n],"_"==n.slice(0,1)&&"undefined"==typeof e[n]){if(t=e[n.slice(1)],!t)return}else t=e[n];"object"==typeof o?Array.isArray(o)?t.map(function(e){o[0]&&"object"==typeof o[0]&&"object"==typeof e&&u(e,o[0])}):u(t,o):"string"==typeof o?s(e,r,n):console.error("无法解析key: \n"+("string"==typeof o?o:"object"==typeof o?JSON.stringify(o):""))}))}var l=function(e,r,t){var i=t?e instanceof Array?o(e):n(e):e;return r&&"object"==typeof r?u(i,r):console.error("传入的map格式有误，请传入对象或数组"),i};JSON.refactor=l}(this);