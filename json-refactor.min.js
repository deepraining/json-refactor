!function(e){function r(e){return e}function t(){var e=arguments[0];if("undefined"==typeof e||null===e)return{};if("object"!=typeof e)return e;var r,o=arguments[1],i=!0;o instanceof Array||(o=e,i=!1);var a,c={};for(a in o)r=i?o[a]:a,e.hasOwnProperty(r)&&(e[r]instanceof Array?c[r]=n(e[r]):"object"==typeof e[r]?c[r]=t(e[r]):c[r]=e[r]);return c}function n(e){if("undefined"==typeof e||null===e)return[];if(!(e instanceof Array))return[];var r=[];return e.map(function(e,n){"object"!=typeof e?r[n]=e:r[n]=t(e)}),r}function o(r,t){switch(t){case"int":return parseInt(r);case"float":return parseFloat(r);case"bool":return!!r;case"string":return r+"";default:return e[t]&&"function"==typeof e[t]?r=e[t](r):console.error(""+t+"：没有此内置操作，也无此全局函数"),r}}function i(e,r,i,a){var c,s=i.split("."),u=s.length,l=s[u-1],p=!!~l.indexOf("[]");if(2==u)c=p?void 0!=e[s[0]]&&e[s[0]]:void 0!=e[s[0]]&&e[s[0]][s[1]];else if(3==u)c=p?void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&e[s[0]][s[1]]:void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&e[s[0]][s[1]][s[2]];else{if(4!=u)return void console.error("点语法的解析最大只支持四级");c=p?void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&void 0!=e[s[0]][s[1]][s[2]]&&e[s[0]][s[1]][s[2]]:void 0!=e[s[0]]&&void 0!=e[s[0]][s[1]]&&void 0!=e[s[0]][s[1]][s[2]]&&e[s[0]][s[1]][s[2]][s[3]]}p?e[r]=f(c,l):"object"!=typeof c?e[r]=a?o(c,a):c:Array.isArray(c)?e[r]=n(c):e[r]=t(c)}function a(e,r,t,n,i){var a=e[t];e[r]=n?o(a,n):a,r!=t&&!i&&delete e[t]}function c(e,r,t){e[r]=f(e,t)}function f(e,t){var n,o=t.split("|"),i=o[0].slice(0,-2),a=o[1],c=o[2],f=o[3],s=o[4],u=!!s,l=e[i],p=0,y=0,d=0,v=0,b=[];if(!l||!Array.isArray(l))return void console.error("配置的键 "+i+" 不存在，或者值不是数组");if(u)switch(s){case"round":n=Math.round;break;case"floor":n=Math.floor;break;case"ceil":n=Math.ceil;break;case"abs":n=Math.abs;break;default:n=r,"concat"!=c&&console.error("子操作 "+s+" 不存在")}switch(c){case"sum":return l.map(function(e){p+=u?n(e[a]):e[a]}),p;case"average":return l.map(function(e){p+=u?n(e[a]):e[a]}),y=p/l.length;case"max":return l.map(function(e,r){var t=u?n(e[a]):e[a];r?t>d&&(d=t):d=t}),d;case"min":return l.map(function(e,r){var t=u?n(e[a]):e[a];r?t<v&&(v=t):v=t}),v;case"concat":return l.map(function(e){var r=u?e[a][s]():e[a];b.push(r)}),b.join(f?f:"");default:return void console.error("操作 "+c+" 不存在")}}function s(e,r,t){var n=r[t],o=!!~n.indexOf("^"),f=o?n.slice(0,-1):n,s=f.split("!"),u=s[0],l=s[1],p=!!~u.indexOf("."),y=!p&&!!~u.indexOf("[]");p?u.split(".").length>1?i(e,t,u,l):console.error("配置键名 "+f+" 有误"):y?c(e,t,u):a(e,t,u,l,o)}function u(e,r){r&&"object"==typeof r&&(Array.isArray(r)?e.map(function(e){!!r[0]&&"object"==typeof r[0]&&"object"==typeof e&&u(e,r[0])}):Object.keys(r).map(function(t){var n,o;if(n=r[t],t.startsWith("_")&&"undefined"==typeof e[t]){if(o=e[t.slice(1)],!o)return}else o=e[t];"object"==typeof n?Array.isArray(n)?o.map(function(e){n[0]&&"object"==typeof n[0]&&"object"==typeof e&&u(e,n[0])}):u(o,n):"string"==typeof n?s(e,r,t):console.error("无法解析key: \n"+("string"==typeof n?n:"object"==typeof n?JSON.stringify(n):""))}))}var l=function(e,r,o){var i=o?e instanceof Array?n(e):t(e):e;return r&&"object"==typeof r?u(i,r):console.error("传入的map格式有误，请传入对象或数组"),i};JSON.refactor=l}(this);